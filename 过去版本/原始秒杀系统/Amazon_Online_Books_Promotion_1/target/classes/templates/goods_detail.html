<!DOCTYPE html>
<html>

<head>
	<title>商品详情</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- jquery -->
	<script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
	<!-- bootstrap -->
	<link rel="stylesheet" type="text/css" th:href="@{/bootstrap/css/bootstrap.min.css}" />
	<script type="text/javascript" th:src="@{/bootstrap/js/bootstrap.min.js}"></script>
	<!-- jquery-validator -->
	<script type="text/javascript" th:src="@{/jquery-validation/jquery.validate.min.js}"></script>
	<script type="text/javascript" th:src="@{/jquery-validation/localization/messages_zh.min.js}"></script>
	<!-- layer -->
	<script type="text/javascript" th:src="@{/layer/layer.js}"></script>
	<!-- md5.js -->
	<script type="text/javascript" th:src="@{/js/md5.min.js}"></script>
	<!-- common.js -->
	<script type="text/javascript" th:src="@{/js/common.js}"></script>
	<!-- css -->
	<link rel="stylesheet" type="text/css" th:href="@{/css/goods_detail.css}" />
</head>

<script>
	$(function () {
		countDown();
	});

	function countDown() {
		var remainSeconds = $("#remainSeconds").val();
		var timeout;
		if (remainSeconds > 0) {//秒杀还没开始，倒计时
			$("#buyButton").attr("disabled", true);
			timeout = setTimeout(function () {
				$("#countDown").text(remainSeconds - 1);
				$("#remainSeconds").val(remainSeconds - 1);
				countDown();
			}, 1000);
		} else if (remainSeconds == 0) {//秒杀进行中
			$("#buyButton").attr("disabled", false);
			if (timeout) {
				clearTimeout(timeout);
			}
			$("#miaoshaTip").html("秒杀进行中");
		} else {//秒杀已经结束
			$("#buyButton").attr("disabled", true);
			$("#miaoshaTip").html("秒杀已经结束");
		}
	}

</script>

<body>
	<nav class="navbar navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a th:href="'/goods/to_list/'" class="navbar-brand">商城</a>
			</div>
			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav pull-right">
					<li><a th:href="'/login/to_login/'">登录</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div class="container">
		<div class="row">
			<div class="col col-md-3">
				<img class="book img-responsive" th:src="@{${goods.goodsImg}}" />
			</div>
			<div class="col col-md-9">
				<div class="caption-full">
					<h1><strong><span th:text="${goods.goodsName}"></span></strong></h1>
					<hr class="separator"/>
					<div class="block thumbnail">
						<p><strong>Kindle 价格:</strong></p>
						<div class="emphasis">
							<s><span class="block" th:text="'$'+${goods.goodsPrice}"></span></s>
							<strong><span th:text="'$'+${goods.miaoshaPrice}"></span></strong>
						</div>
						<p><strong>库存:</strong></p>
						<div class="emphasis">
							<span th:text="${goods.stockCount}+'本'"></span>
						</div>
					</div>
					<hr class="separator"/>
					<p><strong>秒杀开始时间:</strong></p>
					<div class="emphasis">
						<div th:text="${#dates.format(goods.startDate, 'yyyy-MM-dd HH:mm:ss')}"></div>
						<div id="miaoshaTip">
							<input type="hidden" id="remainSeconds" th:value="${remainSeconds}" />
							<span th:if="${miaoshaStatus eq 0}">秒杀倒计时：<span id="countDown"
									th:text="${remainSeconds}"></span>秒</span>
							<span th:if="${miaoshaStatus eq 1}">秒杀进行中</span>
							<span th:if="${miaoshaStatus eq 2}">秒杀已结束</span>
						</div>
					</div>
				</div>
				<div class="text-right">
					<form id="miaoshaForm" method="post" action="/miaosha/do_miaosha">
						<button class="btn btn-success btn-block" type="submit" id="buyButton">立即秒杀</button>
						<input type="hidden" name="goodsId" th:value="${goods.id}" />
					</form>
				</div>
			</div>
		</div>
	</div>

</body>

</html>